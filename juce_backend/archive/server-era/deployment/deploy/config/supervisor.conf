# Supervisor configuration for Schillinger SDK HTTP Server
# Provides process monitoring and auto-restart capabilities

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[supervisord]
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childreaddir=/var/run/supervisor
nodaemon=false
minfds=1024
minprocs=200

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[include]
files = /etc/supervisor/conf.d/*.conf

# Schillinger SDK HTTP Server
[program:schillinger-server]
command=/opt/schillinger/venv/bin/python src/audio_agent/tools/local_schillinger_server.py --host 0.0.0.0 --port 8350 --log-level info
directory=/opt/schillinger
user=schillinger
autostart=true
autorestart=true
startsecs=10
startretries=3
stopwaitsecs=30
stopsignal=TERM
stopasgroup=true
killasgroup=true

environment=SCHILLINGER_HOST=0.0.0.0,SCHILLINGER_PORT=8350,BUILD_ENV=production,PYTHONPATH=/opt/schillinger/src

stdout_logfile=/var/log/schillinger/server.log
stdout_logfile_maxbytes=100MB
stdout_logfile_backups=5
stdout_capture_maxbytes=1MB
stdout_events_enabled=true

stderr_logfile=/var/log/schillinger/server_error.log
stderr_logfile_maxbytes=100MB
stderr_logfile_backups=5
stderr_capture_maxbytes=1MB
stderr_events_enabled=true

# Health check for the service
[eventlistener:healthcheck]
events=PROCESS_STATE
command=/opt/schillinger/scripts/healthcheck.py schillinger-server