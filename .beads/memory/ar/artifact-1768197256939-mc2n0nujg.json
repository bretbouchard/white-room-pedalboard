{
  "id": "artifact-1768197256939-mc2n0nujg",
  "type": "error_message",
  "content": "# MIDI Export Bug Fix: Same Pitch Notes\n\n## Problem\nNotes with the same pitch had incorrect delta times when exported to MIDI files.\n\n## Symptoms\n**Before Fix**:\n```\nNote ON times: 0, 840, 1200, 1560 ❌ (incorrect spacing)\nExpected: 0, 480, 960, 1440 ✅\n```\n\n## Root Cause\nIncorrect sorting by `delta_time_ppq` in `createNoteTrack` function caused notes with same pitch to be reordered, breaking the delta time calculation.\n\n## Solution\nRemoved the incorrect sorting (4 lines of code) that was sorting notes by `delta_time_ppq` before writing to MIDI. The notes were already in correct order from the expansion engine.\n\n## Code Change\n```cpp\n// REMOVED (lines that caused bug):\n// std::sort(notes.begin(), notes.end(), \n//     [](const NoteEvent& a, const NoteEvent& b) {\n//         return a.delta_time_ppq < b.delta_time_ppq;\n//     });\n```\n\n## Regression Test Added\n```cpp\nTEST(MIDITest, SamePitchNotes_ExportsCorrectly) {\n    // Create role with multiple notes of same pitch\n    // Export to MIDI\n    // Verify correct delta times\n}\n```\n\n## Result\nAll MIDI files now export correctly with proper note timing regardless of pitch.\n\n## Date Fixed\n2025-01-11\n\n## Lesson\nDon't re-sort data that's already in correct order. The expansion engine produces notes in proper time order; sorting by a derived field (delta_time_ppq) destroyed that order.",
  "metadata": {
    "scope": "submodule",
    "submodule": "daw_control",
    "tags": [],
    "confidence": 1
  },
  "timestamp": "2026-01-12T05:54:16.939Z"
}